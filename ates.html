<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Komentar Publik</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 10px; margin: 0; background: #f5f5f5; }
    h2 { margin-top: 20px; }
    input, textarea, button {
      width: 100%; padding: 10px; margin-top: 10px;
      box-sizing: border-box; border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      background: #007bff; color: white; border: none; font-weight: bold;
    }
    button:hover { background: #0056b3; }
    .komentar {
      background: white; padding: 10px; border-radius: 10px;
      margin-top: 15px; box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .foto { max-width: 100%; margin-top: 10px; border-radius: 8px; }
    .balasan { color: #555; font-style: italic; margin-top: 5px; }
    .ikon-login {
      text-align: center; margin: 20px 0;
      font-size: 24px; cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>Kirim Informasi</h2>
  <input id="nama" placeholder="Nama">
  <textarea id="informasi" placeholder="Informasi"></textarea>
  <input type="file" id="file">
  <button onclick="kirim()">Kirim</button>
  <p id="status"></p>

  <div class="ikon-login" onclick="login()">
    üìù
  </div>

  <h2>Komentar Publik</h2>
  <div id="komentar"></div>

  <script>
    const URL = 'https://script.google.com/macros/s/AKfycbyftHVscifLH1RtqgXtGpRDsrNsuXbmE6WtjNI37WbfE9ATsjFcvS7YOX9vctTn6Hnk/exec';
    let isLogin = false;

    function kirim() {
      const nama = document.getElementById('nama').value.trim();
      const informasi = document.getElementById('informasi').value.trim();
      const file = document.getElementById('file').files[0];

      if (!nama || !informasi || !file) {
        document.getElementById('status').innerText = "Isi semua kolom dan pilih file!";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const base64Data = e.target.result.split(',')[1];
        const mimeType = file.type;

        const form = new FormData();
        form.append('nama', nama);
        form.append('informasi', informasi);
        form.append('file', base64Data);
        form.append('mimeType', mimeType);

        fetch(URL, { method: 'POST', body: form })
          .then(r => r.json())
          .then(res => {
            document.getElementById('status').innerText = res.status === "sukses" ? "Berhasil dikirim." : "Gagal: " + res.error;
            loadKomentar();
          });
      };
      reader.readAsDataURL(file);
    }

    function login() {
      const pwd = prompt("Masukkan password:");
      if (pwd === "0000") {
        isLogin = true;
        loadKomentar();
      }
    }

    function balasKomentar(waktu, textarea) {
      const reply = textarea.value.trim();
      if (!reply) return alert("Isi balasan tidak boleh kosong.");

      const form = new FormData();
      form.append('waktu', waktu);
      form.append('reply', reply);

      fetch(URL, { method: 'PUT', body: form })
        .then(r => r.text())
        .then(res => {
          alert(res);
          loadKomentar();
        });
    }

    function loadKomentar() {
      fetch(URL)
        .then(r => r.json())
        .then(data => {
          const div = document.getElementById('komentar');
          div.innerHTML = "";
          data.reverse().forEach(row => {
            const el = document.createElement('div');
            el.className = 'komentar';
            el.innerHTML = `
              <b>${row.nama}</b> - ${row.waktu}<br>${row.informasi}
              ${row.foto ? `<br><img src="${row.foto}" class="foto">` : ""}
              ${row.reply ? `<div class="balasan">${row.reply}</div>` : ""}
              ${isLogin && !row.reply ? `
                <textarea placeholder="Balasan..."></textarea>
                <button onclick="balasKomentar('${row.waktu}', this.previousElementSibling)">Kirim</button>
              ` : ""}
            `;
            div.appendChild(el);
          });
        });
    }

    loadKomentar();
  </script>
</body>
</html>
